<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abimbola School</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background-color: #f5f7fa;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .auth-box {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
            color: white;
        }
        .auth-header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin: 1rem 0 0.5rem 0;
        }
        .auth-logo {
            font-size: 3rem;
        }
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
        .form-section h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #333;
        }
        .form-section input, .form-section select {
            margin-bottom: 1rem;
        }
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        .stat-card p {
            color: #666;
            margin: 0;
        }
        .nav-tabs .nav-link {
            color: #333;
            border-color: transparent;
        }
        .nav-tabs .nav-link.active {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .error-message {
            color: #dc3545;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        .success-message {
            color: #28a745;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        .nav-tabs .nav-link {
            color: #333;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .nav-tabs .nav-link:hover {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        .nav-tabs .nav-link.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background-color: transparent;
        }
        .fee-management-tab-content {
            display: block !important;
            width: 100% !important;
            visibility: visible !important;
            min-height: 100px;
        }
        .fee-management-tab-content .tab-pane {
            display: none !important;
            min-height: 200px;
        }
        .fee-management-tab-content .tab-pane.show,
        .fee-management-tab-content .tab-pane.active {
            display: block !important;
            visibility: visible !important;
            min-height: 200px;
        }
        /* Force all children to be visible when tab is active */
        .fee-management-tab-content .tab-pane.show > *,
        .fee-management-tab-content .tab-pane.active > * {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        .tab-pane {
            display: none !important;
        }
        .tab-pane.show,
        .tab-pane.active {
            display: block !important;
        }
        .navbar-brand {
            font-size: 1.3rem;
            font-weight: bold;
            color: #667eea;
        }
        /* Responsive spacing for Students Tab */
        #studentsTab {
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }
        #studentsTab .row {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        #studentsTab .card {
            margin-bottom: 0 !important;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="auth-container">
            <div>
                <div class="auth-header">
                    <div class="auth-logo">üìö</div>
                    <h1>Abimbola School</h1>
                    <p>Management Portal</p>
                </div>
                <div class="auth-box" id="loginBox">
                    <h2 class="text-center mb-4">Sign In</h2>
                    <div class="mb-3">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <div class="input-group">
                            <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('loginPassword')" id="loginPasswordToggle">
                                <span class="password-toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <button onclick="handleLogin()" class="btn btn-primary w-100 mb-3">Sign In</button>
                    <div id="loginError" class="error-message"></div>
                    <p class="text-center mt-2">
                        <a href="#" onclick="openForgotPasswordModal(event)" style="color: #667eea; cursor: pointer; font-size: 0.9rem;">Forgot Password?</a>
                    </p>
                    <p class="text-center mt-3">
                        Don't have an account? <a href="#" onclick="toggleAuthForm(event)" style="color: #667eea; cursor: pointer;">Sign Up</a>
                    </p>
                </div>
                <div class="auth-box" id="signupBox" style="display: none;">
                    <h2 class="text-center mb-4">Create Account</h2>
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="signupName" class="form-control" placeholder="Enter your name">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="signupEmail" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <div class="input-group">
                            <input type="password" id="signupPassword" class="form-control" placeholder="Enter password (min 6 characters)">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('signupPassword')" id="signupPasswordToggle">
                                <span class="password-toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <button onclick="handleSignup()" class="btn btn-primary w-100 mb-3">Create Account</button>
                    <div id="signupError" class="error-message"></div>
                    <p class="text-center mt-3">
                        Already have an account? <a href="#" onclick="toggleAuthForm(event)" style="color: #667eea; cursor: pointer;">Sign In</a>
                    </p>
                </div>
                <div class="auth-box" id="pendingBox" style="display: none;">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">‚è≥</div>
                        <h2>Approval Pending</h2>
                        <p>Your account has been created and is waiting for admin approval.</p>
                        <p style="color: #666; font-size: 0.9rem;">This usually takes 1-2 hours.</p>
                        <button onclick="handleLogout()" class="btn btn-secondary mt-3">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="forgotPasswordModalLabel">üîê Reset Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="forgotPasswordStep1" class="mb-3">
                        <p class="text-muted mb-3">Enter your email address and we'll send you a link to reset your password.</p>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" id="forgotPasswordEmail" class="form-control" placeholder="Enter your email address">
                        </div>
                        <div id="forgotPasswordError" class="error-message"></div>
                    </div>
                    <div id="forgotPasswordStep2" class="mb-3" style="display: none;">
                        <p class="text-success mb-3">‚úÖ Password reset email sent!</p>
                        <p class="text-muted mb-3">Check your email for a link to reset your password. The link will expire in 1 hour.</p>
                        <p class="text-muted small mb-3">If you don't see the email, check your spam folder.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="forgotPasswordCloseBtn">Close</button>
                    <button type="button" class="btn btn-primary" id="forgotPasswordSendBtn" onclick="handleForgotPassword()">Send Reset Link</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Page -->
    <div id="adminPage" class="page">
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom border-3" style="border-color: #667eea !important; padding: 0.5rem 0;">
            <div class="container-fluid px-4">
                <span class="navbar-brand">
                    <span class="me-2">üë®‚Äçüíº</span>Admin Panel
                </span>
                <div class="ms-auto d-flex gap-2 align-items-center flex-wrap">
                    <span id="adminName"></span>
                    <button onclick="switchPage('dashboardPage')" class="btn btn-info btn-sm">Dashboard</button>
                    <button onclick="handleLogout()" class="btn btn-danger btn-sm">Logout</button>
                </div>
            </div>
        </nav>

        <div class="container-fluid px-3 px-md-4" style="padding-top: 0;">
            <!-- Admin Navigation Tabs -->
            <ul class="nav nav-tabs mb-3" role="tablist" id="adminTabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#" onclick="showTeachersTab(event)">Teachers</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showStudentsTab(event)">Students</a>
                </li>
            </ul>

            <!-- Teachers Tab -->
            <div id="teachersTab" class="tab-pane show active" role="tabpanel">
                <div class="row">
                    <div class="col-12 col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">‚è≥ Pending Teacher Approvals</h5>
                            </div>
                            <div id="pendingTeachersList" class="card-body">
                                <p class="text-muted">Loading...</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-6">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">‚úÖ Approved Teachers</h5>
                            </div>
                            <div id="approvedTeachersList" class="card-body">
                                <p class="text-muted">Loading...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students Tab -->
            <div id="studentsTab" class="tab-pane" role="tabpanel">
                <div id="adminStudentForm" class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">‚ûï Register New Student</h5>
                            </div>
                            <div class="card-body">
                                <form id="studentRegistrationForm" onsubmit="handleRegisterStudent(event)">
                                    <div class="row">
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Student Name *</label>
                                            <input type="text" id="studentName" class="form-control" required>
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Email Address</label>
                                            <input type="text" id="studentEmail" class="form-control" placeholder="Optional">
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Class *</label>
                                            <select id="studentClass" class="form-control" required>
                                                <option value="">-- Select Class --</option>
                                                <option value="Pry 1">Primary 1</option>
                                                <option value="Pry 2">Primary 2</option>
                                                <option value="Pry 3">Primary 3</option>
                                                <option value="Pry 4">Primary 4</option>
                                                <option value="Pry 5">Primary 5</option>
                                                <option value="JS 1">Junior Secondary 1</option>
                                                <option value="JS 2">Junior Secondary 2</option>
                                                <option value="JS 3">Junior Secondary 3</option>
                                                <option value="SS 1 Science">Senior Secondary 1 (Science)</option>
                                                <option value="SS 2 Science">Senior Secondary 2 (Science)</option>
                                                <option value="SS 3 Science">Senior Secondary 3 (Science)</option>
                                                <option value="SS 1 Art">Senior Secondary 1 (Art)</option>
                                                <option value="SS 2 Art">Senior Secondary 2 (Art)</option>
                                                <option value="SS 3 Art">Senior Secondary 3 (Art)</option>
                                                <option value="SS 1 Commercial">Senior Secondary 1 (Commercial)</option>
                                                <option value="SS 2 Commercial">Senior Secondary 2 (Commercial)</option>
                                                <option value="SS 3 Commercial">Senior Secondary 3 (Commercial)</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Session *</label>
                                            <select id="studentSession" class="form-control" required>
                                                <option value="">-- Select Session --</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Date of Birth</label>
                                            <input type="date" id="studentDOB" class="form-control">
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Registration Number</label>
                                            <input type="text" id="studentRegNum" class="form-control" placeholder="Leave empty to auto-generate (YYYY-###)">
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Parent Name</label>
                                            <input type="text" id="studentParentName" class="form-control">
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Parent Phone</label>
                                            <input type="tel" id="studentParentPhone" class="form-control">
                                        </div>
                                        <div class="col-12 col-md-6 mb-3">
                                            <label class="form-label">Student Phone</label>
                                            <input type="tel" id="studentPhone" class="form-control">
                                        </div>
                                        <div class="col-12 mb-3">
                                            <label class="form-label">Address</label>
                                            <textarea id="studentAddress" class="form-control" rows="2"></textarea>
                                        </div>

                                        <!-- Optional Fees Section -->
                                        <div class="col-12 mb-3">
                                            <hr>
                                            <h6>üöå Optional Services</h6>
                                        </div>

                                        <div class="col-12 col-md-6 mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="studentUsesSchoolBus" onchange="toggleBusFeeSection()">
                                                <label class="form-check-label" for="studentUsesSchoolBus">
                                                    <strong>Student uses school bus</strong>
                                                </label>
                                            </div>
                                        </div>

                                        <div id="busFeeSection" style="display: none;" class="col-12">
                                            <div class="row">
                                                <div class="col-12 col-md-4 mb-3">
                                                    <label class="form-label">Bus Timing *</label>
                                                    <select id="studentBusTiming" class="form-control" onchange="updateBusFeeAmount()">
                                                        <option value="">-- Select Timing --</option>
                                                        <option value="Morning Only" data-amount="10000">Morning Only - ‚Ç¶10,000/term</option>
                                                        <option value="Closing Only" data-amount="10000">Closing Only - ‚Ç¶10,000/term</option>
                                                        <option value="Both" data-amount="20000">Both (Morning & Closing) - ‚Ç¶20,000/term</option>
                                                    </select>
                                                </div>
                                                <div class="col-12 col-md-4 mb-3">
                                                    <label class="form-label">Bus Fee (per term)</label>
                                                    <input type="number" id="studentBusFee" class="form-control" readonly>
                                                </div>
                                                <div class="col-12 col-md-4 mb-3">
                                                    <label class="form-label">Start Date</label>
                                                    <input type="date" id="studentBusStartDate" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <button type="submit" class="btn btn-success">Register Student</button>
                                            <div id="studentRegisterMessage" class="mt-2"></div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">üë• Registered Students</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" id="studentSearch" class="form-control" placeholder="Search by name, class, or registration number...">
                                </div>
                                <div id="studentsList">
                                    <p class="text-muted">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fees Tab -->
            </div>
        </div>
    </div>
    <div class="modal fade" id="assignTeacherModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Assign Teacher: <span id="editTeacherName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editTeacherId">
                    
                    <div class="mb-3">
                        <label class="form-label">Role</label>
                        <select id="editTeacherRole" class="form-control">
                            <option value="teacher">Teacher</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Department</label>
                        <div style="border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.75rem;">
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Primary School Department" id="dept_primary">
                                <label class="form-check-label" for="dept_primary">Primary School Department</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Junior Secondary" id="dept_js">
                                <label class="form-check-label" for="dept_js">Junior Secondary</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Senior Secondary Science" id="dept_ss_science">
                                <label class="form-check-label" for="dept_ss_science">Senior Secondary Science</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Senior Secondary Art" id="dept_ss_art">
                                <label class="form-check-label" for="dept_ss_art">Senior Secondary Art</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Senior Secondary Commercial" id="dept_ss_commercial">
                                <label class="form-check-label" for="dept_ss_commercial">Senior Secondary Commercial</label>
                            </div>
                            <hr class="my-2">
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Principal" id="dept_principal">
                                <label class="form-check-label" for="dept_principal">Principal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Headmaster" id="dept_headmaster">
                                <label class="form-check-label" for="dept_headmaster">Headmaster</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Vice Principal" id="dept_vice_principal">
                                <label class="form-check-label" for="dept_vice_principal">Vice Principal</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Burser" id="dept_burser">
                                <label class="form-check-label" for="dept_burser">Burser</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Proprietor" id="dept_proprietor">
                                <label class="form-check-label" for="dept_proprietor">Proprietor</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input department-checkbox" type="checkbox" value="Director" id="dept_director">
                                <label class="form-check-label" for="dept_director">Director</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" id="editTeacherPhone" class="form-control" placeholder="Phone number">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Assigned Classes</label>
                        <div style="border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 0.75rem; max-height: 250px; overflow-y: auto;">
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="Pry 1" id="class_pry1">
                                <label class="form-check-label" for="class_pry1">Primary 1</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="Pry 2" id="class_pry2">
                                <label class="form-check-label" for="class_pry2">Primary 2</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="Pry 3" id="class_pry3">
                                <label class="form-check-label" for="class_pry3">Primary 3</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="Pry 4" id="class_pry4">
                                <label class="form-check-label" for="class_pry4">Primary 4</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="Pry 5" id="class_pry5">
                                <label class="form-check-label" for="class_pry5">Primary 5</label>
                            </div>
                            <hr class="my-2">
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="JS 1" id="class_js1">
                                <label class="form-check-label" for="class_js1">Junior Secondary 1</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="JS 2" id="class_js2">
                                <label class="form-check-label" for="class_js2">Junior Secondary 2</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="JS 3" id="class_js3">
                                <label class="form-check-label" for="class_js3">Junior Secondary 3</label>
                            </div>
                            <hr class="my-2">
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 1 Science" id="class_ss1s">
                                <label class="form-check-label" for="class_ss1s">Senior Secondary 1 (Science)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 2 Science" id="class_ss2s">
                                <label class="form-check-label" for="class_ss2s">Senior Secondary 2 (Science)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 3 Science" id="class_ss3s">
                                <label class="form-check-label" for="class_ss3s">Senior Secondary 3 (Science)</label>
                            </div>
                            <hr class="my-2">
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 1 Art" id="class_ss1a">
                                <label class="form-check-label" for="class_ss1a">Senior Secondary 1 (Art)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 2 Art" id="class_ss2a">
                                <label class="form-check-label" for="class_ss2a">Senior Secondary 2 (Art)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 3 Art" id="class_ss3a">
                                <label class="form-check-label" for="class_ss3a">Senior Secondary 3 (Art)</label>
                            </div>
                            <hr class="my-2">
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 1 Commercial" id="class_ss1c">
                                <label class="form-check-label" for="class_ss1c">Senior Secondary 1 (Commercial)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 2 Commercial" id="class_ss2c">
                                <label class="form-check-label" for="class_ss2c">Senior Secondary 2 (Commercial)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox" value="SS 3 Commercial" id="class_ss3c">
                                <label class="form-check-label" for="class_ss3c">Senior Secondary 3 (Commercial)</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Assigned Subjects (comma-separated)</label>
                        <textarea id="editTeacherSubjects" class="form-control" rows="2" placeholder="e.g., Mathematics, English, Physics"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="handleSaveTeacherAssignment()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div class="modal fade" id="editStudentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Student: <span id="editStudentName"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="editStudentId">
                    
                    <div class="mb-3">
                        <label class="form-label">Student Name *</label>
                        <input type="text" id="editStudentFormName" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Email Address</label>
                        <input type="text" id="editStudentFormEmail" class="form-control" placeholder="Optional">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Class *</label>
                        <select id="editStudentFormClass" class="form-control" required>
                            <option value="">-- Select Class --</option>
                            <option value="Pry 1">Primary 1</option>
                            <option value="Pry 2">Primary 2</option>
                            <option value="Pry 3">Primary 3</option>
                            <option value="Pry 4">Primary 4</option>
                            <option value="Pry 5">Primary 5</option>
                            <option value="JS 1">Junior Secondary 1</option>
                            <option value="JS 2">Junior Secondary 2</option>
                            <option value="JS 3">Junior Secondary 3</option>
                            <option value="SS 1 Science">Senior Secondary 1 (Science)</option>
                            <option value="SS 2 Science">Senior Secondary 2 (Science)</option>
                            <option value="SS 3 Science">Senior Secondary 3 (Science)</option>
                            <option value="SS 1 Art">Senior Secondary 1 (Art)</option>
                            <option value="SS 2 Art">Senior Secondary 2 (Art)</option>
                            <option value="SS 3 Art">Senior Secondary 3 (Art)</option>
                            <option value="SS 1 Commercial">Senior Secondary 1 (Commercial)</option>
                            <option value="SS 2 Commercial">Senior Secondary 2 (Commercial)</option>
                            <option value="SS 3 Commercial">Senior Secondary 3 (Commercial)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Date of Birth</label>
                        <input type="date" id="editStudentFormDOB" class="form-control">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Registration Number</label>
                        <input type="text" id="editStudentFormRegNum" class="form-control" disabled>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Parent Name</label>
                        <input type="text" id="editStudentFormParentName" class="form-control">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Parent Phone</label>
                        <input type="tel" id="editStudentFormParentPhone" class="form-control">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Student Phone</label>
                        <input type="tel" id="editStudentFormPhone" class="form-control">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea id="editStudentFormAddress" class="form-control" rows="2"></textarea>
                    </div>

                    <!-- Bus Fee Management -->
                    <hr>
                    <h6>üöå School Bus Service</h6>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editStudentUsesSchoolBus" onchange="toggleEditBusFeeSection()">
                            <label class="form-check-label" for="editStudentUsesSchoolBus">
                                <strong>Student uses school bus</strong>
                            </label>
                        </div>
                    </div>

                    <div id="editBusFeeSection" style="display: none;">
                        <div class="row">
                            <div class="col-12 col-md-6 mb-3">
                                <label class="form-label">Bus Timing *</label>
                                <select id="editStudentBusTiming" class="form-control" onchange="updateEditBusFeeAmount()">
                                    <option value="">-- Select Timing --</option>
                                    <option value="Morning Only" data-amount="10000">Morning Only - ‚Ç¶10,000/term</option>
                                    <option value="Closing Only" data-amount="10000">Closing Only - ‚Ç¶10,000/term</option>
                                    <option value="Both" data-amount="20000">Both (Morning & Closing) - ‚Ç¶20,000/term</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label class="form-label">Bus Fee (per term)</label>
                                <input type="number" id="editStudentBusFee" class="form-control" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div id="editStudentMessage" class="mt-3"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="handleSaveStudentChanges()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Announcement Modal -->
    <div class="modal fade" id="editAnnouncementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Title</label>
                        <input type="text" id="editAnnouncementTitle" class="form-control" placeholder="Announcement title">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Content</label>
                        <textarea id="editAnnouncementContent" class="form-control" rows="5" placeholder="Announcement content"></textarea>
                    </div>
                    <div id="editAnnouncementMessage" class="mt-3"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="handleDeleteAnnouncement()" style="margin-right: auto;">Delete</button>
                    <button type="button" class="btn btn-primary" onclick="handleSaveAnnouncementChanges()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page">
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom border-3" style="border-color: #667eea !important; padding: 0.75rem 0;">
            <div class="container-fluid px-3 px-md-4">
                <span class="navbar-brand me-3"><span class="me-2">üìö</span>Abimbola School</span>
                
                <!-- Desktop Navigation -->
                <div class="d-none d-lg-flex align-items-center gap-3 flex-grow-1">
                    <div class="d-flex gap-2 align-items-center">
                        <div class="stat-badge"><small class="stat-label">Classes</small><strong id="statsClassesNav" class="stat-value">0</strong></div>
                        <div class="stat-badge"><small class="stat-label">Students</small><strong id="statsStudentsNav" class="stat-value">0</strong></div>
                        <div class="stat-badge"><small class="stat-label">Subjects</small><strong id="statsSubjectsNav" class="stat-value">0</strong></div>
                        <div class="stat-badge"><small class="stat-label">Announcements</small><strong id="statsAnnouncementsNav" class="stat-value">0</strong></div>
                    </div>
                    <div style="width: 1px; height: 30px; background-color: #e2e8f0;"></div>
                    <ul class="nav gap-1 border-0" role="tablist">
                        <li class="nav-item"><button class="nav-link nav-link-sm" onclick="switchTab('overview')">üìä Overview</button></li>
                        <li class="nav-item"><button class="nav-link nav-link-sm" onclick="switchTab('classes')">üìö Classes</button></li>
                        <li class="nav-item"><button class="nav-link nav-link-sm" onclick="switchTab('attendance')">‚úì Attendance</button></li>
                        <li class="nav-item"><button class="nav-link nav-link-sm" onclick="switchTab('results')">üìù Results</button></li>
                        <li class="nav-item"><button class="nav-link nav-link-sm" onclick="switchTab('announcements')">üì¢ Announcements</button></li>
                        <li class="nav-item"><button class="nav-link nav-link-sm" onclick="switchTab('profile')">üë§ Profile</button></li>
                    </ul>
                </div>
                
                <div class="d-none d-lg-flex gap-2 align-items-center ms-auto">
                    <span id="teacherName" class="text-muted"></span>
                    <button id="adminPanelBtn" onclick="showAdminPanel()" class="btn btn-primary btn-sm" style="display: none;">Admin</button>
                    <button onclick="handleLogout()" class="btn btn-danger btn-sm">Logout</button>
                </div>
                
                <button class="navbar-toggler d-lg-none ms-auto" type="button" data-bs-toggle="collapse" data-bs-target="#mobileMenu">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </nav>
        
        <div class="collapse navbar-collapse d-lg-none bg-light border-bottom" id="mobileMenu">
            <div class="container-fluid px-3 px-md-4 py-3">
                <div class="mb-3"><span id="teacherName" class="d-block text-muted small mb-2"></span></div>
                <div class="row g-2 mb-3">
                    <div class="col-6 col-sm-3"><div class="stat-card stat-card-sm"><h6 class="mb-0" id="statsClassesMobile">0</h6><small>Classes</small></div></div>
                    <div class="col-6 col-sm-3"><div class="stat-card stat-card-sm"><h6 class="mb-0" id="statsStudentsMobile">0</h6><small>Students</small></div></div>
                    <div class="col-6 col-sm-3"><div class="stat-card stat-card-sm"><h6 class="mb-0" id="statsSubjectsMobile">0</h6><small>Subjects</small></div></div>
                    <div class="col-6 col-sm-3"><div class="stat-card stat-card-sm"><h6 class="mb-0" id="statsAnnouncementsMobile">0</h6><small>Announcements</small></div></div>
                </div>
                <nav class="nav flex-column gap-1 mb-3 border-top pt-3">
                    <button class="nav-link text-start" onclick="switchTab('overview'); document.getElementById('mobileMenu').classList.remove('show');">üìä Overview</button>
                    <button class="nav-link text-start" onclick="switchTab('classes'); document.getElementById('mobileMenu').classList.remove('show');">üìö My Classes</button>
                    <button class="nav-link text-start" onclick="switchTab('attendance'); document.getElementById('mobileMenu').classList.remove('show');">‚úì Attendance</button>
                    <button class="nav-link text-start" onclick="switchTab('results'); document.getElementById('mobileMenu').classList.remove('show');">üìù Results</button>
                    <button class="nav-link text-start" onclick="switchTab('announcements'); document.getElementById('mobileMenu').classList.remove('show');">üì¢ Announcements</button>
                    <button class="nav-link text-start" onclick="switchTab('profile'); document.getElementById('mobileMenu').classList.remove('show');">üë§ Profile</button>
                    <button class="nav-link text-start" id="feeManagementMobileBtn" style="display: none;" onclick="switchTab('feeManagement'); document.getElementById('mobileMenu').classList.remove('show');">üí∞ Fee Management</button>
                </nav>
                <div class="d-flex flex-column gap-2">
                    <button id="adminPanelBtnMobile" onclick="showAdminPanel()" class="btn btn-primary btn-sm" style="display: none;">Admin Panel</button>
                    <button onclick="handleLogout()" class="btn btn-danger btn-sm w-100">Logout</button>
                </div>
            </div>
        </div>

        <div class="container-fluid px-3 px-md-4 py-4">
            <!-- Statistics Cards - Desktop Only -->
            <div class="row g-3 mb-4 d-none d-lg-flex">
                <div class="col-12 col-sm-6 col-lg-3">
                    <div class="stat-card">
                        <h3 id="statsClasses">0</h3>
                        <p>My Classes</p>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-3">
                    <div class="stat-card">
                        <h3 id="statsStudents">0</h3>
                        <p>Total Students</p>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-3">
                    <div class="stat-card">
                        <h3 id="statsSubjects">0</h3>
                        <p>Subjects Teaching</p>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-3">
                    <div class="stat-card">
                        <h3 id="statsAnnouncements">0</h3>
                        <p>Announcements</p>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation - Desktop Only -->
            <ul class="nav nav-tabs mb-4 flex-wrap d-none d-lg-flex" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" onclick="switchTab('overview')">üìä Overview</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="switchTab('classes')">üìö My Classes</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="switchTab('attendance')">‚úì Attendance</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="switchTab('results')">üìù Results</button>
                </li>
                <li class="nav-item" id="feeManagementTabBtn" style="display: none;">
                    <button class="nav-link" onclick="switchTab('feeManagement')">üí∞ Fee Management</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="switchTab('announcements')">üì¢ Announcements</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="switchTab('profile')">üë§ Profile</button>
                </li>
            </ul>

            <!-- Overview Tab -->
            <div id="overviewTab" class="tab-content active">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">üîî Pending Actions</h5>
                            </div>
                            <div id="pendingContent" class="card-body">
                                <!-- Pending items will load here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Classes Tab -->
            <div id="classesTab" class="tab-content">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üìö Assigned Classes</h5>
                    </div>
                    <div id="classesContent" class="card-body">
                        <!-- Classes will load here -->
                    </div>
                </div>
            </div>

            <!-- Attendance Tab -->
            <div id="attendanceTab" class="tab-content">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">‚úì Mark Attendance</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Class</label>
                                <select id="attendanceClass" class="form-control" onchange="loadAttendanceStudents()">
                                    <option value="">-- Select Class --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Attendance Date</label>
                                <input type="date" id="attendanceDate" class="form-control">
                            </div>
                        </div>
                        <div id="attendanceStudentsContent">
                            <!-- Students will load here -->
                        </div>
                        <button onclick="submitAttendance()" class="btn btn-success mt-3">Submit Attendance</button>
                    </div>
                </div>

                <!-- Attendance Statistics Section -->
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üìä Attendance Statistics</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Class (for chart)</label>
                                <select id="statsAttendanceClass" class="form-control" onchange="loadAttendanceChart()">
                                    <option value="">-- Select Class --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Date</label>
                                <input type="date" id="statsAttendanceDate" class="form-control" onchange="loadAttendanceChart()">
                            </div>
                        </div>
                        <div id="attendanceChartContainer" class="position-relative" style="height: 300px;">
                            <canvas id="attendanceChart"></canvas>
                        </div>
                        <div id="attendanceStatsText" class="mt-3 text-center">
                            <p class="text-muted">Select a class and date to view statistics</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Tab -->
            <div id="resultsTab" class="tab-content">
                <!-- Enter Results Section -->
                <div class="card mb-4" id="enterResultsCard">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üìù Enter Results</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Class</label>
                                <select id="resultsClass" class="form-control" onchange="loadResultsSubjects()">
                                    <option value="">-- Select Class --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Session</label>
                                <select id="resultsSession" class="form-control" onchange="loadResultsStudents()">
                                    <option value="">-- Select Session --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Subject</label>
                                <select id="resultsSubject" class="form-control" onchange="loadResultsStudents()">
                                    <option value="">-- Select Subject --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Term</label>
                                <select id="resultsTerm" class="form-control" onchange="loadResultsStudents()">
                                    <option value="">-- Select Term --</option>
                                    <option value="term1">Term 1</option>
                                    <option value="term2">Term 2</option>
                                    <option value="term3">Term 3</option>
                                </select>
                            </div>
                        </div>
                        <div id="resultsStudentsContent">
                            <!-- Results table will load here -->
                        </div>
                        <div id="resultsMessage" class="mt-3"></div>
                        <button onclick="submitResultForm()" class="btn btn-success mt-3">Save Results</button>
                    </div>
                </div>

                <!-- View Results Section -->
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">üìä View Results</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Class</label>
                                <select id="viewResultsClass" class="form-control" onchange="loadViewResultsSubjects()">
                                    <option value="">-- Select Class --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Session</label>
                                <select id="viewResultsSession" class="form-control" onchange="loadViewResults()">
                                    <option value="">-- Select Session --</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Term</label>
                                <select id="viewResultsTerm" class="form-control" onchange="loadViewResults()">
                                    <option value="">-- Select Term --</option>
                                    <option value="term1">Term 1</option>
                                    <option value="term2">Term 2</option>
                                    <option value="term3">Term 3</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-6">
                                <label class="form-label">Select Subject</label>
                                <select id="viewResultsSubject" class="form-control" onchange="loadViewResults()">
                                    <option value="">-- All Subjects --</option>
                                </select>
                            </div>
                        </div>
                        <div id="viewResultsContent">
                            <!-- Results table will load here -->
                        </div>
                        <button onclick="printResults()" class="btn btn-primary mt-3" id="printBtn" style="display: none;">üñ®Ô∏è Print Results</button>
                    </div>
                </div>
            </div>

            <!-- Subject Registration Tab -->


            <!-- Announcements Tab -->
            <div id="announcementsTab" class="tab-content">
                <div id="adminAnnouncementForm" class="card mb-4" style="display: none;">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üì¢ Post Announcement</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Announcement Title</label>
                            <input type="text" id="announcementTitle" class="form-control" placeholder="Enter title">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Announcement Message</label>
                            <textarea id="announcementMessage" class="form-control" rows="4" placeholder="Enter message"></textarea>
                        </div>
                        <button onclick="postAnnouncement()" class="btn btn-primary">Post Announcement</button>
                        <div id="announcementFormMessage" class="mt-2"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">üì¢ All Announcements</h5>
                    </div>
                    <div id="announcementsContent" class="card-body">
                        <p class="text-muted">Loading announcements...</p>
                    </div>
                </div>
            </div>

            <!-- Fee Management Tab (Admin Only) -->
            <div id="feeManagementTab" class="tab-content">
                <!-- Fee Management Sub-Navigation -->
                <div class="row mb-4">
                    <div class="col-12">
                        <ul class="nav nav-tabs" role="tablist" style="border-bottom: 2px solid #dee2e6;">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="feeStructureSubTab" data-bs-toggle="tab" data-bs-target="#feeStructureSection" type="button" role="tab" aria-controls="feeStructureSection" aria-selected="true" style="border: none; padding: 12px 20px; cursor: pointer;">
                                    <span style="font-size: 16px;">‚öôÔ∏è</span> Fee Structure
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="feeSummarySubTab" data-bs-toggle="tab" data-bs-target="#feeSummarySection" type="button" role="tab" aria-controls="feeSummarySection" aria-selected="false" style="border: none; padding: 12px 20px; cursor: pointer;">
                                    <span style="font-size: 16px;">üìä</span> Fee Summary
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="recordPaymentSubTab" data-bs-toggle="tab" data-bs-target="#recordPaymentSection" type="button" role="tab" aria-controls="recordPaymentSection" aria-selected="false" style="border: none; padding: 12px 20px; cursor: pointer;">
                                    <span style="font-size: 16px;">üíµ</span> Record Payment
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="feeDetailsSubTab" data-bs-toggle="tab" data-bs-target="#feeDetailsSection" type="button" role="tab" aria-controls="feeDetailsSection" aria-selected="false" style="border: none; padding: 12px 20px; cursor: pointer;">
                                    <span style="font-size: 16px;">üìã</span> Fee Details
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="busManagementSubTab" data-bs-toggle="tab" data-bs-target="#busManagementSection" type="button" role="tab" aria-controls="busManagementSection" aria-selected="false" style="border: none; padding: 12px 20px; cursor: pointer;">
                                    <span style="font-size: 16px;">üöå</span> Bus Fee
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="reprintReceiptSubTab" data-bs-toggle="tab" data-bs-target="#reprintReceiptSection" type="button" role="tab" aria-controls="reprintReceiptSection" aria-selected="false" style="border: none; padding: 12px 20px; cursor: pointer;">
                                    <span style="font-size: 16px;">üñ®Ô∏è</span> Reprint Receipt
                                </button>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Tab Contents -->
                <div class="fee-management-tab-content" id="feeManagementTabContent">
                    <!-- Fee Structure Section -->
                    <div class="tab-pane active show" id="feeStructureSection" role="tabpanel" aria-labelledby="feeStructureSubTab">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0">üí∞ Fee Structure Setup</h5>
                            </div>
                            <div class="card-body">
                                <form id="feeStructureForm" onsubmit="handleCreateFeeStructure(event)">
                                    <div class="row">
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Academic Session *</label>
                                            <select id="feeStructureSession" class="form-control" required>
                                                <option value="">-- Select Session --</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Select Class *</label>
                                            <select id="feeStructureClass" class="form-control" required>
                                                <option value="">-- Select Class --</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Select Term *</label>
                                            <select id="feeStructureTerm" class="form-control" required>
                                                <option value="">-- Select Term --</option>
                                                <option value="firstTerm">First Term</option>
                                                <option value="secondTerm">Second Term</option>
                                                <option value="thirdTerm">Third Term</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-4 mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="button" class="btn btn-outline-secondary w-100" onclick="loadExistingFeeStructure()">Load Existing</button>
                                        </div>
                                    </div>

                                    <div id="feeItemsContainer">
                                        <div class="row mb-3">
                                            <div class="col-12">
                                                <h6>Fee Items</h6>
                                            </div>
                                        </div>
                                        <div class="fee-item-row row mb-2" data-fee-index="0">
                                            <div class="col-12 col-md-6 mb-2">
                                                <input type="text" class="form-control fee-item-name" placeholder="Fee Type (e.g., Tuition)" value="Tuition">
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <input type="number" class="form-control fee-item-amount" placeholder="Amount" value="45000" min="0" oninput="calculateTotalFee()">
                                            </div>
                                            <div class="col-12 col-md-2 mb-2">
                                                <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeFeeItem(0)">Remove</button>
                                            </div>
                                        </div>
                                        <div class="fee-item-row row mb-2" data-fee-index="1">
                                            <div class="col-12 col-md-6 mb-2">
                                                <input type="text" class="form-control fee-item-name" placeholder="Fee Type (e.g., Development)" value="Development">
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <input type="number" class="form-control fee-item-amount" placeholder="Amount" value="5000" min="0" oninput="calculateTotalFee()">
                                            </div>
                                            <div class="col-12 col-md-2 mb-2">
                                                <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeFeeItem(1)">Remove</button>
                                            </div>
                                        </div>
                                        <div class="fee-item-row row mb-2" data-fee-index="2">
                                            <div class="col-12 col-md-6 mb-2">
                                                <input type="text" class="form-control fee-item-name" placeholder="Fee Type (e.g., Exam)" value="Exam">
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <input type="number" class="form-control fee-item-amount" placeholder="Amount" value="3000" min="0" oninput="calculateTotalFee()">
                                            </div>
                                            <div class="col-12 col-md-2 mb-2">
                                                <button type="button" class="btn btn-danger btn-sm w-100" onclick="removeFeeItem(2)">Remove</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row mb-3 mt-3">
                                        <div class="col-12">
                                            <button type="button" class="btn btn-outline-primary" onclick="addFeeItem()">+ Add Fee Item</button>
                                        </div>
                                    </div>

                                    <div class="row mb-3 p-3 bg-light rounded">
                                        <div class="col-12">
                                            <h6 class="mb-0">Total Fee: <span id="totalFeeDisplay" class="text-success">‚Ç¶53,000</span></h6>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12">
                                            <button type="submit" class="btn btn-success">Save & Initialize Student Fees</button>
                                            <button type="reset" class="btn btn-secondary">Reset</button>
                                            <div id="feeStructureMessage" class="mt-2"></div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                    <!-- Class Fee Summary Section -->
                    <div class="tab-pane" id="feeSummarySection" role="tabpanel" aria-labelledby="feeSummarySubTab">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0">üìä Class Fee Summary</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-12 col-md-3 mb-2">
                                                <label class="form-label">Academic Session</label>
                                                <select id="summarySession" class="form-control" onchange="loadClassFeeSummary()">
                                                    <option value="">-- Select Session --</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-3 mb-2">
                                                <label class="form-label">Select Class</label>
                                                <select id="feeSummaryClass" class="form-control" onchange="loadClassFeeSummary()">
                                                    <option value="">-- Select Class --</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-3 mb-2">
                                                <label class="form-label">Select Term</label>
                                                <select id="summaryTerm" class="form-control" onchange="loadClassFeeSummary()">
                                                    <option value="">-- Select Term --</option>
                                                    <option value="firstTerm">First Term</option>
                                                    <option value="secondTerm">Second Term</option>
                                                    <option value="thirdTerm">Third Term</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div id="feeSummaryStats" class="row mb-4">
                                            <div class="col-12 col-md-3 mb-3">
                                                <div class="stat-card border-start border-5" style="border-color: #667eea !important;">
                                                    <h6 class="text-muted mb-2">Total Students</h6>
                                                    <h3 id="summaryStudents">0</h3>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-3 mb-3">
                                                <div class="stat-card border-start border-5" style="border-color: #17a2b8 !important;">
                                                    <h6 class="text-muted mb-2">Expected Fees</h6>
                                                    <h3 id="summaryExpected" style="color: #17a2b8;">‚Ç¶0</h3>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-3 mb-3">
                                                <div class="stat-card border-start border-5" style="border-color: #28a745 !important;">
                                                    <h6 class="text-muted mb-2">Collected</h6>
                                                    <h3 id="summaryCollected" style="color: #28a745;">‚Ç¶0</h3>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-3 mb-3">
                                                <div class="stat-card border-start border-5" style="border-color: #dc3545 !important;">
                                                    <h6 class="text-muted mb-2">Outstanding</h6>
                                                    <h3 id="summaryOutstanding" style="color: #dc3545;">‚Ç¶0</h3>
                                                </div>
                                            </div>
                                        </div>

                                        <div id="feeSummaryDetails" style="overflow-x: auto;">
                                            <p class="text-muted">Select a class and term to view details</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Record Payment Section -->
                    <div class="tab-pane" id="recordPaymentSection" role="tabpanel" aria-labelledby="recordPaymentSubTab">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">üíµ Record Student Payment</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="recordPaymentForm" onsubmit="handleRecordPayment(event)">
                                            <div class="row">
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Select Student *</label>
                                            <select id="paymentStudentClass" class="form-control" onchange="loadStudentsForPayment()" required>
                                                <option value="">-- Select Class --</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Academic Session *</label>
                                            <select id="paymentSession" class="form-control" onchange="loadStudentsForPayment()" required>
                                                <option value="">-- Select Session --</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Student Name *</label>
                                            <div class="input-group mb-2">
                                                <input type="text" id="paymentStudentSearch" class="form-control" placeholder="Search student..." oninput="filterStudentSelect('paymentStudent', 'paymentStudentSearch')">
                                            </div>
                                            <select id="paymentStudent" class="form-control" required>
                                                <option value="">-- Select Student --</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <button type="button" class="btn btn-outline-info w-100" onclick="loadStudentFeeStatus()">View Fee Status</button>
                                        </div>
                                    </div>

                                    <div id="studentFeeStatusCard" class="row mb-3" style="display: none;">
                                        <div class="col-12">
                                            <div class="card bg-light">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-12 col-md-3 text-center">
                                                            <h6 class="text-muted">Total Fee</h6>
                                                            <h5 id="feeStatusTotal">‚Ç¶0</h5>
                                                        </div>
                                                        <div class="col-12 col-md-3 text-center">
                                                            <h6 class="text-muted">Paid</h6>
                                                            <h5 id="feeStatusPaid" style="color: #28a745;">‚Ç¶0</h5>
                                                        </div>
                                                        <div class="col-12 col-md-3 text-center">
                                                            <h6 class="text-muted">Balance</h6>
                                                            <h5 id="feeStatusBalance" style="color: #dc3545;">‚Ç¶0</h5>
                                                        </div>
                                                        <div class="col-12 col-md-3 text-center">
                                                            <h6 class="text-muted">Status</h6>
                                                            <h5 id="feeStatusStatus">--</h5>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Term *</label>
                                            <select id="paymentTerm" class="form-control" required>
                                                <option value="">-- Select Term --</option>
                                                <option value="firstTerm">First Term</option>
                                                <option value="secondTerm">Second Term</option>
                                                <option value="thirdTerm">Third Term</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Amount Paid (‚Ç¶) *</label>
                                            <input type="number" id="paymentAmount" class="form-control" placeholder="0" required min="0">
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">Payment Date *</label>
                                            <input type="date" id="paymentDate" class="form-control" required>
                                        </div>
                                        <div class="col-12 col-md-3 mb-3">
                                            <label class="form-label">&nbsp;</label>
                                            <div class="mt-4"></div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12 col-md-4 mb-3">
                                            <label class="form-label">Payment Method *</label>
                                            <select id="paymentMethod" class="form-control" required>
                                                <option value="">-- Select Method --</option>
                                                <option value="Cash">Cash</option>
                                                <option value="Transfer">Bank Transfer</option>
                                                <option value="POS">POS</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-4 mb-3">
                                            <label class="form-label">Received By (Admin Name)</label>
                                            <input type="text" id="paymentReceivedBy" class="form-control" placeholder="Admin/Bursar name" readonly>
                                        </div>
                                        <div class="col-12 col-md-4 mb-3">
                                            <label class="form-label">Reference (e.g., Transfer Reference)</label>
                                            <input type="text" id="paymentReference" class="form-control" placeholder="Optional">
                                        </div>
                                    </div>

                                            <div class="row">
                                                <div class="col-12">
                                                    <button type="submit" class="btn btn-primary">Record Payment</button>
                                                    <button type="reset" class="btn btn-secondary">Clear</button>
                                                    <div id="recordPaymentMessage" class="mt-2"></div>
                                                </div>
                                            </div>
                                        </form>

                                        <!-- Receipt Display -->
                                        <div id="receiptContent" class="mt-4" style="display: none;">
                                            <!-- Receipt will be displayed here -->
                                        </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                    <!-- Student Fee Details Section -->
                    <div class="tab-pane" id="feeDetailsSection" role="tabpanel" aria-labelledby="feeDetailsSubTab">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="mb-0">üìã Student Fee Details & Payment History</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-12 col-md-4 mb-2">
                                                <label class="form-label">Select Student</label>
                                                <select id="detailsStudentClass" class="form-control" onchange="loadStudentsForDetails()">
                                                    <option value="">-- Select Class --</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <label class="form-label">Student Name</label>
                                                <div class="input-group mb-2">
                                                    <input type="text" id="detailsStudentSearch" class="form-control" placeholder="Search student..." oninput="filterStudentSelect('detailsStudent', 'detailsStudentSearch')">
                                                </div>
                                                <select id="detailsStudent" class="form-control" onchange="loadStudentFeeDetails()">
                                                    <option value="">-- Select Student --</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <label class="form-label">Academic Session</label>
                                                <select id="detailsSession" class="form-control" onchange="loadStudentFeeDetails()">
                                                    <option value="">-- Select Session --</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div id="studentFeeDetailsContainer" style="overflow-x: auto;">
                                            <p class="text-muted">Select a student to view fee details and payment history</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>

                    <!-- Bus Fee Management Section -->
                    <div class="tab-pane" id="busManagementSection" role="tabpanel" aria-labelledby="busManagementSubTab">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0">üöå School Bus Fee Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <!-- Students Using Bus List -->
                                            <div class="col-12 col-md-6 mb-4">
                                                <h6 class="mb-3">Current Bus Users</h6>
                                                <div id="busStudentsList" style="max-height: 500px; overflow-y: auto;">
                                                    <p class="text-muted">Loading bus users...</p>
                                                </div>
                                            </div>

                                            <!-- Add/Remove Bus Service Form -->
                                            <div class="col-12 col-md-6 mb-4">
                                                <h6 class="mb-3">Manage Bus Service</h6>
                                                <form id="manageBusForm" onsubmit="handleManageBusService(event)">
                                                    <div class="mb-3">
                                                        <label class="form-label">Select Class *</label>
                                                        <select id="busManageClass" class="form-control" onchange="loadStudentsForBusManagement()" required>
                                                            <option value="">-- Select Class --</option>
                                                        </select>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label class="form-label">Select Student *</label>
                                                        <select id="busManageStudent" class="form-control" onchange="loadStudentBusStatus()" required>
                                                            <option value="">-- Select Student --</option>
                                                        </select>
                                                    </div>

                                                    <!-- Current Status Display -->
                                                    <div id="studentBusStatus" class="mb-3 p-3 bg-light rounded" style="display: none;">
                                                        <h6 class="mb-2">Current Status:</h6>
                                                        <p id="busStatusText" class="mb-0"></p>
                                                    </div>

                                                    <div class="mb-3">
                                                        <label class="form-label">Action *</label>
                                                        <select id="busManageAction" class="form-control" onchange="toggleBusManageFields()" required>
                                                            <option value="">-- Select Action --</option>
                                                            <option value="add">Add Bus Service</option>
                                                            <option value="remove">Remove Bus Service</option>
                                                        </select>
                                                    </div>

                                                    <div id="busManageFields" style="display: none;">
                                                        <div class="mb-3">
                                                            <label class="form-label">Bus Timing *</label>
                                                            <select id="busManageTiming" class="form-control" onchange="updateBusManageFeeAmount()">
                                                                <option value="">-- Select Timing --</option>
                                                                <option value="Morning Only" data-amount="10000">Morning Only - ‚Ç¶10,000/term</option>
                                                                <option value="Closing Only" data-amount="10000">Closing Only - ‚Ç¶10,000/term</option>
                                                                <option value="Both" data-amount="20000">Both (Morning & Closing) - ‚Ç¶20,000/term</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label class="form-label">Bus Fee (per term)</label>
                                                            <input type="number" id="busManageFee" class="form-control" readonly>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label class="form-label">Start Date</label>
                                                            <input type="date" id="busManageStartDate" class="form-control">
                                                        </div>
                                                    </div>

                                                    <button type="submit" class="btn btn-primary">Update Bus Service</button>
                                                    <div id="busManageMessage" class="mt-2"></div>
                                                </form>
                                            </div>
                                        </div>

                                        <!-- Bus Fee Summary -->
                                        <div class="row mt-4">
                                            <div class="col-12">
                                                <hr>
                                                <h6 class="mb-3">Bus Fee Summary Report</h6>
                                                <div class="row mb-3">
                                                    <div class="col-12 col-md-3 mb-2">
                                                        <label class="form-label">Academic Session</label>
                                                        <select id="busSummarySession" class="form-control" onchange="loadBusFeeSummary()">
                                                            <option value="">-- Select Session --</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-12 col-md-3 mb-2">
                                                        <label class="form-label">Term</label>
                                                        <select id="busSummaryTerm" class="form-control" onchange="loadBusFeeSummary()">
                                                            <option value="">-- Select Term --</option>
                                                            <option value="firstTerm">First Term</option>
                                                            <option value="secondTerm">Second Term</option>
                                                            <option value="thirdTerm">Third Term</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-12 col-md-3 mb-2">
                                                        <label class="form-label">Class (Optional)</label>
                                                        <select id="busSummaryClass" class="form-control" onchange="loadBusFeeSummary()">
                                                            <option value="">-- All Classes --</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-12 col-md-3 mb-2">
                                                        <label class="form-label">&nbsp;</label>
                                                        <button type="button" class="btn btn-info w-100" onclick="loadBusFeeSummary()">Generate Report</button>
                                                    </div>
                                                </div>
                                                <div id="busFeeSummaryContainer">
                                                    <p class="text-muted">Select session and term to generate bus fee summary report. Optionally filter by class.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reprint Receipt Section -->
                    <div class="tab-pane" id="reprintReceiptSection" role="tabpanel" aria-labelledby="reprintReceiptSubTab">
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0">üñ®Ô∏è Reprint Receipt</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-3">
                                            <div class="col-12 col-md-4 mb-2">
                                                <label class="form-label">Select Class</label>
                                                <select id="reprintStudentClass" class="form-control" onchange="loadReprintStudents()">
                                                    <option value="">-- Select Class --</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <label class="form-label">Student Name</label>
                                                <div class="input-group mb-2">
                                                    <input type="text" id="reprintStudentSearch" class="form-control" placeholder="Search student..." oninput="filterStudentSelect('reprintStudent', 'reprintStudentSearch')">
                                                </div>
                                                <select id="reprintStudent" class="form-control" onchange="loadReprintPayments()">
                                                    <option value="">-- Select Student --</option>
                                                </select>
                                            </div>
                                            <div class="col-12 col-md-4 mb-2">
                                                <label class="form-label">Academic Session</label>
                                                <select id="reprintSession" class="form-control" onchange="loadReprintPayments()">
                                                    <option value="">-- Select Session --</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div id="reprintPaymentsContainer" class="mt-3">
                                            <p class="text-muted">Select a student to reprint receipt</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content">
                <div class="row">
                    <div class="col-12 col-lg-8">
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">üë§ Profile Information</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" id="profileName" class="form-control" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="profileEmail" class="form-control" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Department</label>
                                    <input type="text" id="profileDepartment" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" id="profilePhone" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Bio</label>
                                    <textarea id="profileBio" class="form-control" rows="3"></textarea>
                                </div>
                                <button onclick="updateProfile()" class="btn btn-primary">Update Profile</button>
                                <div id="profileMessage" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">üîê Change Password</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Current Password</label>
                                    <input type="password" id="currentPassword" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">New Password</label>
                                    <input type="password" id="newPassword" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Confirm Password</label>
                                    <input type="password" id="confirmPassword" class="form-control">
                                </div>
                                <button onclick="changePassword()" class="btn btn-warning w-100">Change Password</button>
                                <div id="passwordMessage" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Firebase SDK (Compat versions for vanilla JS) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js for attendance charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Services -->
    <script src="src/services/firebase.js"></script>
    <script src="src/services/authService.js"></script>
    <script src="src/services/teacherService.js"></script>
    <script src="src/services/studentService.js"></script>
    <script src="src/services/attendanceService.js"></script>
    <script src="src/services/resultsService.js"></script>
    <script src="src/services/announcementService.js"></script>
    <script src="src/services/subjectRegistrationService.js"></script>
    <script src="src/services/feeService.js"></script>
    <script src="src/utils/rbac.js"></script>
    
    <!-- App Script -->
    <script src="app.js"></script>
    
    <!-- Initialize Bootstrap Tabs -->
    <script>
        // Initialize all tab triggers with explicit click handlers
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMContentLoaded event fired');
            
            // Check if Bootstrap is loaded
            if (typeof bootstrap === 'undefined') {
                console.error('Bootstrap is not loaded!');
                return;
            }
            
            // Find all tab buttons
            const tabButtons = document.querySelectorAll('[data-bs-toggle="tab"]');
            console.log('Found', tabButtons.length, 'tab triggers');
            
            tabButtons.forEach((button) => {
                // Initialize Bootstrap tab
                const bsTab = new bootstrap.Tab(button);
                
                // Add click handler to manually ensure tab shows
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Tab clicked:', this.id);
                    
                    // Get the target pane ID
                    const targetId = this.getAttribute('data-bs-target');
                    console.log('Target ID:', targetId);
                    
                    // Hide all tab panes
                    const allPanes = document.querySelectorAll('.fee-management-tab-content .tab-pane');
                    allPanes.forEach(pane => {
                        pane.classList.remove('show', 'active');
                    });
                    
                    // Remove active from all buttons
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    
                    // Show selected pane
                    const targetPane = document.querySelector(targetId);
                    if (targetPane) {
                        targetPane.classList.add('show', 'active');
                        console.log('Showing pane:', targetId);
                    } else {
                        console.error('Target pane not found:', targetId);
                    }
                    
                    // Mark button as active
                    this.classList.add('active');
                    this.setAttribute('aria-selected', 'true');
                    
                    // Also call Bootstrap's show method
                    bsTab.show();
                });
            });
            
            console.log('Tab initialization complete');
        });
    </script>
</body>
</html>
